<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Safety Dashboard</title>
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui;background:#0f1422;color:#e0e0e0;padding:20px}.container{max-width:1400px;margin:0 auto}h1{color:#00d9ff;margin-bottom:10px}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin-bottom:20px}.stat-card{background:rgba(255,255,255,0.05);border:1px solid rgba(0,217,255,0.25);border-radius:12px;padding:16px;text-align:center}.stat-value{font-size:2rem;font-weight:700;color:#00d9ff}.stat-value.critical{color:#ff5252}.tabs{display:flex;gap:10px;margin-bottom:10px;border-bottom:2px solid rgba(0,217,255,0.2)}.tab{padding:10px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(0,217,255,0.2);border-bottom:none;border-radius:8px 8px 0 0;cursor:pointer;color:#aab}.tab.active{background:rgba(0,217,255,0.2);color:#00d9ff;border-color:#00d9ff}.tab-content{display:none}.tab-content.active{display:block}.content-section{background:rgba(255,255,255,0.05);border:1px solid rgba(0,217,255,0.2);border-radius:12px;padding:16px}table{width:100%;border-collapse:collapse;margin-top:10px}th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.1)}thead th{background:rgba(0,217,255,0.12);color:#00d9ff;border-bottom:2px solid rgba(0,217,255,0.3)}tr:hover{background:rgba(0,217,255,0.05)}.severity-badge{padding:4px 10px;border-radius:16px;font-size:0.8rem;font-weight:600}.severity-critical{background:#ff5252;color:#fff}.severity-high{background:#ff9f2e;color:#000}.status-badge{padding:4px 10px;border-radius:16px;font-size:0.8rem;font-weight:600}.status-banned{background:#ff5252;color:#fff}.status-flagged{background:#ff9f2e;color:#000}.refresh-button{background:rgba(0,217,255,0.2);border:1px solid #00d9ff;color:#00d9ff;padding:8px 14px;border-radius:8px;cursor:pointer}</style></head>
<body><div class="container"><h1> Safety Dashboard</h1><p>Live violations, flagged accounts, and emergency events</p>
<div class="stats-grid"><div class="stat-card"><div class="stat-value" id="total-violations">0</div><div>Violations</div></div><div class="stat-card"><div class="stat-value critical" id="critical-violations">0</div><div>Critical</div></div><div class="stat-card"><div class="stat-value" id="flagged-accounts">0</div><div>Flagged</div></div><div class="stat-card"><div class="stat-value critical" id="emergency-events">0</div><div>Emergencies</div></div></div>
<div style="display:flex;justify-content:space-between;margin:8px 0"><div class="tabs"><div class="tab active" data-tab="violations">Violations</div><div class="tab" data-tab="flagged">Flagged</div><div class="tab" data-tab="emergencies">Emergencies</div></div><button class="refresh-button" onclick="loadAll()"></button></div>
<div id="violations" class="tab-content active"><div class="content-section"><table><thead><tr><th>Time</th><th>User</th><th>Category</th><th>Severity</th><th>Reason</th><th>Action</th></tr></thead><tbody id="violations-body"><tr><td colspan="6" style="text-align:center">No violations</td></tr></tbody></table></div></div>
<div id="flagged" class="tab-content"><div class="content-section"><table><thead><tr><th>User</th><th>IP</th><th>Status</th><th>Severity</th><th>Reason</th><th>Flagged</th></tr></thead><tbody id="flagged-body"><tr><td colspan="6" style="text-align:center">No flagged accounts</td></tr></tbody></table></div></div>
<div id="emergencies" class="tab-content"><div class="content-section"><table><thead><tr><th>Time</th><th>User</th><th>Type</th><th>Description</th><th>Contact</th><th>Authorities</th></tr></thead><tbody id="emergencies-body"><tr><td colspan="6" style="text-align:center">No emergency events</td></tr></tbody></table></div></div>
</div>
<script>document.querySelectorAll('.tab').forEach(tab=>{tab.addEventListener('click',()=>{document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));tab.classList.add('active');document.getElementById(tab.dataset.tab).classList.add('active')})});const fmt=ts=>new Date(ts).toLocaleString();async function loadViolations(){const r=await fetch('/safety/violations');const d=await r.json();const rows=(d.violations||[]).map(v=>`<tr><td>${fmt(v.timestamp)}</td><td>${v.user_id||'N/A'}</td><td><b>${v.category}</b></td><td><span class="severity-badge severity-${(v.severity||'').toLowerCase()}">${v.severity}</span></td><td>${v.reason}</td><td>${v.action_taken}</td></tr>`).join('');document.getElementById('violations-body').innerHTML=rows||'<tr><td colspan="6" style="text-align:center">No violations</td></tr>';document.getElementById('total-violations').textContent=(d.violations||[]).length;document.getElementById('critical-violations').textContent=(d.violations||[]).filter(v=>v.severity==='CRITICAL').length}async function loadFlagged(){const r=await fetch('/safety/flagged');const d=await r.json();const rows=(d.accounts||[]).map(a=>`<tr><td><b>${a.user_id}</b></td><td>${a.ip_address||'N/A'}</td><td><span class="status-badge status-${(a.status||'').toLowerCase()}">${a.status}</span></td><td><span class="severity-badge severity-${(a.severity||'').toLowerCase()}">${a.severity}</span></td><td>${a.reason}</td><td>${fmt(a.flagged_at)}</td></tr>`).join('');document.getElementById('flagged-body').innerHTML=rows||'<tr><td colspan="6" style="text-align:center">No flagged accounts</td></tr>';document.getElementById('flagged-accounts').textContent=(d.accounts||[]).length}async function loadEmergencies(){const r=await fetch('/safety/emergencies');const d=await r.json();const rows=(d.events||[]).map(e=>`<tr><td>${fmt(e.timestamp)}</td><td>${e.user_id||'N/A'}</td><td><b>${e.event_type}</b></td><td>${e.description}</td><td>${e.emergency_contact_notified?'':''}</td><td>${e.authorities_contacted?'':''}</td></tr>`).join('');document.getElementById('emergencies-body').innerHTML=rows||'<tr><td colspan="6" style="text-align:center">No emergencies</td></tr>';document.getElementById('emergency-events').textContent=(d.events||[]).length}function loadAll(){loadViolations();loadFlagged();loadEmergencies()}loadAll();setInterval(loadAll,30000)</script></body></html>
